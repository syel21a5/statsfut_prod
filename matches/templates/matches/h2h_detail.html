{% extends 'base.html' %}
{% load static %}
{% load matches_extras %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="text-white fw-bold mb-0">
                <i class="fa-solid fa-right-left text-info me-2"></i>
                Head-to-Head
            </h2>
            <p class="text-secondary mb-0 mt-1">
                <span class="text-info">{{ league.name }}</span> <i class="fa-solid fa-chevron-right mx-2 small"></i> {{ team1.name }} vs {{ team2.name }}
            </p>
        </div>
        <a href="{% url 'matches:league_goals' league_name=league.name|slugify %}"
            class="btn btn-outline-secondary btn-sm">
            <i class="fa-solid fa-arrow-left me-1"></i> Back to League
        </a>
    </div>


    <div class="row">
        <div class="col-lg-9">
            <!-- Matchup Header Card -->
            <div class="card border-0 bg-white bg-opacity-10 text-white shadow-sm mb-4">
                <div class="card-body p-4">
                    <div class="row align-items-center">
                        <!-- Team 1 -->
                        <div class="col-md-4 text-center">
                            <h3 class="fw-bold mb-1">{{ team1.name }}</h3>
                            {% if t1_standing %}
                            <span
                                class="badge bg-primary bg-opacity-25 text-primary border border-primary border-opacity-25 mb-2">
                                {{ t1_standing.position }}th Place
                            </span>
                            {% endif %}
                            <div class="d-flex justify-content-center gap-3 text-secondary small mt-2">
                                <span><i class="fa-solid fa-futbol me-1"></i>{{ t1_stats.total.gf|default:0 }} GF</span>
                                <span><i class="fa-solid fa-shield-halved me-1"></i>{{ t1_stats.total.ga|default:0 }}
                                    GA</span>
                            </div>
                        </div>

                        <!-- VS / Score -->
                        <div class="col-md-4">
                            <div class="text-center">
                                <div class="display-6 fw-bold text-info mb-2">VS</div>
                                <div class="text-secondary small text-uppercase tracking-wide mb-3">Total {{ h2h_stats.gp }} Matches Played</div>

                                <!-- H2H Bar -->
                                <div class="progress" style="height: 24px; font-size: 0.8rem;">
                                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%"
                                        data-width="{{ h2h_stats.t1_win_pct }}"
                                        aria-valuenow="{{ h2h_stats.t1_win_pct }}" aria-valuemin="0"
                                        aria-valuemax="100">
                                        {% if h2h_stats.t1_wins > 0 %}{{ h2h_stats.t1_wins }} Wins{% endif %}
                                    </div>
                                    <div class="progress-bar bg-warning text-dark" role="progressbar" style="width: 0%"
                                        data-width="{{ h2h_stats.draw_pct }}" aria-valuenow="{{ h2h_stats.draw_pct }}"
                                        aria-valuemin="0" aria-valuemax="100">
                                        {% if h2h_stats.draws > 0 %}{{ h2h_stats.draws }}{% endif %}
                                    </div>
                                    <div class="progress-bar bg-danger" role="progressbar" style="width: 0%"
                                        data-width="{{ h2h_stats.t2_win_pct }}"
                                        aria-valuenow="{{ h2h_stats.t2_win_pct }}" aria-valuemin="0"
                                        aria-valuemax="100">
                                        {% if h2h_stats.t2_wins > 0 %}{{ h2h_stats.t2_wins }} Wins{% endif %}
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between text-secondary small mt-1">
                                    <span>{{ team1.name }}</span>
                                    <span>Draws</span>
                                    <span>{{ team2.name }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Team 2 -->
                        <div class="col-md-4 text-center">
                            <h3 class="fw-bold mb-1">{{ team2.name }}</h3>
                            {% if t2_standing %}
                            <span
                                class="badge bg-danger bg-opacity-25 text-danger border border-danger border-opacity-25 mb-2">
                                {{ t2_standing.position }}th Place
                            </span>
                            {% endif %}
                            <div class="d-flex justify-content-center gap-3 text-secondary small mt-2">
                                <span><i class="fa-solid fa-futbol me-1"></i>{{ t2_stats.total.gf|default:0 }} GF</span>
                                <span><i class="fa-solid fa-shield-halved me-1"></i>{{ t2_stats.total.ga|default:0 }}
                                    GA</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MAIN GRID: Team 1 Column vs Team 2 Column -->
            <div class="row g-4 mb-4">
                <!-- TEAM 1 COLUMN -->
                <div class="col-lg-6">
                    <!-- Team Header -->
                    <div
                        class="bg-primary bg-opacity-25 text-white p-2 rounded mb-3 border border-primary border-opacity-25 d-flex justify-content-between align-items-center">
                        <span class="fw-bold">{{ team1.name }}</span>
                        <span class="small text-secondary">(this season)</span>
                    </div>

                    <!-- CONTAINER 1: Seasonal match statistics -->
                    <div class="card border-0 bg-white bg-opacity-10 text-white shadow-sm mb-3">
                        <div class="card-header bg-transparent border-bottom border-secondary border-opacity-25 py-2">
                            <h6 class="mb-0 fw-bold small text-uppercase">Seasonal match statistics</h6>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-dark table-sm mb-0 text-center small">
                                    <thead>
                                        <tr class="text-secondary">
                                            <th></th>
                                            <th>GP</th>
                                            <th>W</th>
                                            <th>D</th>
                                            <th>L</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="text-start ps-3 text-secondary">Home</td>
                                            <td class="fw-bold">{{ t1_stats.home.gp }}</td>
                                            <td class="text-success fw-bold">{{ t1_stats.home.w }}</td>
                                            <td>{{ t1_stats.home.d }}</td>
                                            <td class="text-danger fw-bold">{{ t1_stats.home.l }}</td>
                                        </tr>
                                        <tr>
                                            <td class="text-start ps-3 text-secondary">Away</td>
                                            <td class="fw-bold">{{ t1_stats.away.gp }}</td>
                                            <td class="text-success fw-bold">{{ t1_stats.away.w }}</td>
                                            <td>{{ t1_stats.away.d }}</td>
                                            <td class="text-danger fw-bold">{{ t1_stats.away.l }}</td>
                                        </tr>
                                        <tr class="bg-white bg-opacity-10">
                                            <td class="text-start ps-3 fw-bold">Total</td>
                                            <td class="fw-bold">{{ t1_stats.total.gp }}</td>
                                            <td><span class="badge bg-success text-white border border-success">{{ t1_stats.total.w }}</span></td>
                                            <td><span class="badge bg-warning text-dark border border-warning">{{ t1_stats.total.d }}</span></td>
                                            <td><span class="badge bg-danger text-white border border-danger">{{ t1_stats.total.l }}</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <!-- PPG Bars -->
                            <div class="p-3 border-top border-secondary border-opacity-25">
                                <div class="d-flex align-items-center mb-2 small">
                                    <div style="width: 80px;" class="text-secondary">PPG (Home):</div>
                                    <div class="flex-grow-1 mx-2 bg-secondary bg-opacity-25 rounded-pill"
                                        style="height: 6px;">
                                        <div class="bg-info rounded-pill" style="width: 0%; height: 100%;"
                                            data-width="{{ t1_stats.home.ppg_pct }}"></div>
                                    </div>
                                    <div class="fw-bold" style="width: 30px; text-align: right;">{{ t1_stats.home.ppg|floatformat:2 }}</div>
                                </div>
                                <div class="d-flex align-items-center mb-2 small">
                                    <div style="width: 80px;" class="text-secondary">PPG (Away):</div>
                                    <div class="flex-grow-1 mx-2 bg-secondary bg-opacity-25 rounded-pill"
                                        style="height: 6px;">
                                        <div class="bg-info rounded-pill" style="width: 0%; height: 100%;"
                                            data-width="{{ t1_stats.away.ppg_pct }}"></div>
                                    </div>
                                    <div class="fw-bold" style="width: 30px; text-align: right;">{{ t1_stats.away.ppg|floatformat:2 }}</div>
                                </div>
                                <div class="d-flex align-items-center small">
                                    <div style="width: 80px;" class="text-secondary">PPG (Total):</div>
                                    <div class="flex-grow-1 mx-2 bg-secondary bg-opacity-25 rounded-pill"
                                        style="height: 6px;">
                                        <div class="bg-info rounded-pill" style="width: 0%; height: 100%;"
                                            data-width="{{ t1_stats.total.ppg_pct }}"></div>
                                    </div>
                                    <div class="fw-bold" style="width: 30px; text-align: right;">{{ t1_stats.total.ppg|floatformat:2 }}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- CONTAINER 2: Relative form -->
                    <div class="card border-0 bg-white bg-opacity-10 text-white shadow-sm mb-3">
                        <div class="card-header bg-transparent border-bottom border-secondary border-opacity-25 py-2">
                            <h6 class="mb-0 fw-bold small text-uppercase">Relative form</h6>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-dark table-sm mb-0 text-center small">
                                    <thead>
                                        <tr class="text-secondary">
                                            <th class="text-start ps-3">Metric</th>
                                            <th>All</th>
                                            <th>Last 8</th>
                                            <th>Diff.</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="text-start ps-3 text-secondary">Points per Game</td>
                                            <td>{{ t1_stats.total.ppg|floatformat:2 }}</td>
                                            <td class="text-info fw-bold">{{ t1_stats.last_8.ppg|floatformat:2 }}</td>
                                            <td
                                                class="{% if t1_stats.diff.ppg >= 0 %}text-success{% else %}text-danger{% endif %} fw-bold">
                                                {{ t1_stats.diff.ppg }}%
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="text-start ps-3 text-secondary">AVG Goals For</td>
                                            <td>{{ t1_stats.total.avg_gf|floatformat:2 }}</td>
                                            <td class="text-info fw-bold">{{ t1_stats.last_8.avg_gf|floatformat:2 }}
                                            </td>
                                            <td
                                                class="{% if t1_stats.diff.avg_gf >= 0 %}text-success{% else %}text-danger{% endif %} fw-bold">
                                                {{ t1_stats.diff.avg_gf }}%
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="text-start ps-3 text-secondary">AVG Goals Against</td>
                                            <td>{{ t1_stats.total.avg_ga|floatformat:2 }}</td>
                                            <td class="text-info fw-bold">{{ t1_stats.last_8.avg_ga|floatformat:2 }}
                                            </td>
                                            <td
                                                class="{% if t1_stats.diff.avg_ga <= 0 %}text-success{% else %}text-danger{% endif %} fw-bold">
                                                {{ t1_stats.diff.avg_ga }}%
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- CONTAINER 3: Progression -->
                    <div class="card border-0 bg-white bg-opacity-10 text-white shadow-sm mb-3">
                        <div class="card-body p-3">
                            <div class="text-secondary small mb-2 fw-bold">{{ team1.name }}'s progression (home & away)
                            </div>
                            <div class="d-flex align-items-center"
                                style="height: 60px; border-bottom: 1px solid rgba(255,255,255,0.1); position: relative;">
                                <div
                                    style="position: absolute; top: 50%; width: 100%; height: 1px; background: rgba(255,255,255,0.2);">
                                </div>
                                {% for m in t1_matches|slice:":20" reversed %}
                                <div class="flex-fill mx-1 d-flex flex-column justify-content-center align-items-center"
                                    style="height: 100%;">
                                    {% if m.home_team == team1 %}
                                    {% if m.home_score > m.away_score %}
                                    <div class="bg-success rounded-1 w-100"
                                        style="height: 60%; transform: translateY(-50%); margin-top: 50%;"
                                        title="Win vs {{ m.away_team.name }}"></div>
                                    {% elif m.home_score == m.away_score %}
                                    <div class="bg-warning rounded-1 w-100" style="height: 15%;"
                                        title="Draw vs {{ m.away_team.name }}"></div>
                                    {% else %}
                                    <div class="bg-danger rounded-1 w-100"
                                        style="height: 40%; transform: translateY(50%); margin-bottom: 50%;"
                                        title="Loss vs {{ m.away_team.name }}"></div>
                                    {% endif %}
                                    {% else %}
                                    {% if m.away_score > m.home_score %}
                                    <div class="bg-success rounded-1 w-100"
                                        style="height: 60%; transform: translateY(-50%); margin-top: 50%;"
                                        title="Win @ {{ m.home_team.name }}"></div>
                                    {% elif m.away_score == m.home_score %}
                                    <div class="bg-warning rounded-1 w-100" style="height: 15%;"
                                        title="Draw @ {{ m.home_team.name }}"></div>
                                    {% else %}
                                    <div class="bg-danger rounded-1 w-100"
                                        style="height: 40%; transform: translateY(50%); margin-bottom: 50%;"
                                        title="Loss @ {{ m.home_team.name }}"></div>
                                    {% endif %}
                                    {% endif %}
                                </div>
                                {% endfor %}
                            </div>
                            <div class="d-flex justify-content-center gap-3 mt-2 small text-secondary">
                                <span class="text-success fw-bold">win:+2</span>
                                <span class="text-warning fw-bold">draw:0</span>
                                <span class="text-danger fw-bold">defeat:-1</span>
                            </div>
                        </div>
                    </div>

                    <!-- CONTAINER 4: Results -->
                    <div class="card border-0 bg-white bg-opacity-10 text-white shadow-sm mb-3">
                        <div class="card-header bg-transparent border-bottom border-secondary border-opacity-25 py-2">
                            <h6 class="mb-0 fw-bold small text-uppercase">Results</h6>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-dark table-hover mb-0 align-middle small">
                                    <thead>
                                        <tr class="text-secondary text-uppercase" style="font-size: 0.7rem;">
                                            <th class="ps-3" colspan="3">Results</th>
                                            <th class="text-center">2.5+</th>
                                            <th class="text-center">CS</th>
                                            <th class="text-center">FTS</th>
                                            <th class="text-center">HT</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for m in t1_matches|slice:":20" %}
                                        {% with is_home=m.home_team|is_team:team1 %}
                                        <tr
                                            class="{% if m.home_score == m.away_score %}bg-warning bg-opacity-10{% elif is_home and m.home_score > m.away_score %}bg-success bg-opacity-10{% elif not is_home and m.away_score > m.home_score %}bg-success bg-opacity-10{% else %}bg-danger bg-opacity-10{% endif %}">
                                            <td class="ps-3 text-secondary" style="width: 50px;">{{ m.date|date:"d M" }}
                                            </td>

                                            <td class="text-end" style="width: 40%;">
                                                {% if is_home %}
                                                <span class="fw-bold">{{ m.home_team.name }}</span>
                                                {% else %}
                                                {{ m.home_team.name }}
                                                {% endif %}
                                            </td>

                                            <td class="text-center px-1" style="width: 40px;">
                                                <span class="bg-white text-dark fw-bold px-1 rounded-1"
                                                    style="font-size: 0.75rem;">
                                                    {{ m.home_score }}:{{ m.away_score }}
                                                </span>
                                            </td>

                                            <td class="text-start" style="width: 40%;">
                                                {% if not is_home %}
                                                <span class="fw-bold">{{ m.away_team.name }}</span>
                                                {% else %}
                                                {{ m.away_team.name }}
                                                {% endif %}
                                            </td>

                                            <!-- Hidden column for alignment trick if needed, but using colspan=3 for Results header -->

                                            <td class="text-center text-secondary">{% if m.home_score|add:m.away_score > 2.5 %}<i class="fa-solid fa-check text-info"></i>{% else %}-{% endif %}
                                            </td>
                                            <td class="text-center text-secondary">
                                                {% if is_home and m.away_score == 0 %}<i
                                                    class="fa-solid fa-check text-success"></i>
                                                {% elif not is_home and m.home_score == 0 %}<i
                                                    class="fa-solid fa-check text-success"></i>
                                                {% else %}-{% endif %}
                                            </td>
                                            <td class="text-center text-secondary">
                                                {% if is_home and m.home_score == 0 %}<i
                                                    class="fa-solid fa-check text-danger"></i>
                                                {% elif not is_home and m.away_score == 0 %}<i
                                                    class="fa-solid fa-check text-danger"></i>
                                                {% else %}-{% endif %}
                                            </td>
                                            <td class="text-center text-secondary" style="font-size: 0.7rem;">
                                                {% if m.ht_home_score is not None %}{{ m.ht_home_score }}-{{ m.ht_away_score }}{% else %}-{% endif %}
                                            </td>
                                        </tr>
                                        {% endwith %}
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TEAM 2 COLUMN -->
                <div class="col-lg-6">
                    <!-- Team Header -->
                    <div
                        class="bg-danger bg-opacity-25 text-white p-2 rounded mb-3 border border-danger border-opacity-25 d-flex justify-content-between align-items-center">
                        <span class="fw-bold">{{ team2.name }}</span>
                        <span class="small text-secondary">(this season)</span>
                    </div>

                    <!-- CONTAINER 1: Seasonal match statistics -->
                    <div class="card border-0 bg-white bg-opacity-10 text-white shadow-sm mb-3">
                        <div class="card-header bg-transparent border-bottom border-secondary border-opacity-25 py-2">
                            <h6 class="mb-0 fw-bold small text-uppercase">Seasonal match statistics</h6>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-dark table-sm mb-0 text-center small">
                                    <thead>
                                        <tr class="text-secondary">
                                            <th></th>
                                            <th>GP</th>
                                            <th>W</th>
                                            <th>D</th>
                                            <th>L</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="text-start ps-3 text-secondary">Home</td>
                                            <td class="fw-bold">{{ t2_stats.home.gp }}</td>
                                            <td class="text-success fw-bold">{{ t2_stats.home.w }}</td>
                                            <td>{{ t2_stats.home.d }}</td>
                                            <td class="text-danger fw-bold">{{ t2_stats.home.l }}</td>
                                        </tr>
                                        <tr>
                                            <td class="text-start ps-3 text-secondary">Away</td>
                                            <td class="fw-bold">{{ t2_stats.away.gp }}</td>
                                            <td class="text-success fw-bold">{{ t2_stats.away.w }}</td>
                                            <td>{{ t2_stats.away.d }}</td>
                                            <td class="text-danger fw-bold">{{ t2_stats.away.l }}</td>
                                        </tr>
                                        <tr class="bg-white bg-opacity-10">
                                            <td class="text-start ps-3 fw-bold">Total</td>
                                            <td class="fw-bold">{{ t2_stats.total.gp }}</td>
                                            <td><span class="badge bg-success text-white border border-success">{{ t2_stats.total.w }}</span></td>
                                            <td><span class="badge bg-warning text-dark border border-warning">{{ t2_stats.total.d }}</span></td>
                                            <td><span class="badge bg-danger text-white border border-danger">{{ t2_stats.total.l }}</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <!-- PPG Bars -->
                            <div class="p-3 border-top border-secondary border-opacity-25">
                                <div class="d-flex align-items-center mb-2 small">
                                    <div style="width: 80px;" class="text-secondary">PPG (Home):</div>
                                    <div class="flex-grow-1 mx-2 bg-secondary bg-opacity-25 rounded-pill"
                                        style="height: 6px;">
                                        <div class="bg-info rounded-pill" style="width: 0%; height: 100%;"
                                            data-width="{{ t2_stats.home.ppg_pct }}"></div>
                                    </div>
                                    <div class="fw-bold" style="width: 30px; text-align: right;">{{ t2_stats.home.ppg|floatformat:2 }}</div>
                                </div>
                                <div class="d-flex align-items-center mb-2 small">
                                    <div style="width: 80px;" class="text-secondary">PPG (Away):</div>
                                    <div class="flex-grow-1 mx-2 bg-secondary bg-opacity-25 rounded-pill"
                                        style="height: 6px;">
                                        <div class="bg-info rounded-pill" style="width: 0%; height: 100%;"
                                            data-width="{{ t2_stats.away.ppg_pct }}"></div>
                                    </div>
                                    <div class="fw-bold" style="width: 30px; text-align: right;">{{ t2_stats.away.ppg|floatformat:2 }}</div>
                                </div>
                                <div class="d-flex align-items-center small">
                                    <div style="width: 80px;" class="text-secondary">PPG (Total):</div>
                                    <div class="flex-grow-1 mx-2 bg-secondary bg-opacity-25 rounded-pill"
                                        style="height: 6px;">
                                        <div class="bg-info rounded-pill" style="width: 0%; height: 100%;"
                                            data-width="{{ t2_stats.total.ppg_pct }}"></div>
                                    </div>
                                    <div class="fw-bold" style="width: 30px; text-align: right;">{{ t2_stats.total.ppg|floatformat:2 }}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- CONTAINER 2: Relative form -->
                    <div class="card border-0 bg-white bg-opacity-10 text-white shadow-sm mb-3">
                        <div class="card-header bg-transparent border-bottom border-secondary border-opacity-25 py-2">
                            <h6 class="mb-0 fw-bold small text-uppercase">Relative form</h6>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-dark table-sm mb-0 text-center small">
                                    <thead>
                                        <tr class="text-secondary">
                                            <th class="text-start ps-3">Metric</th>
                                            <th>All</th>
                                            <th>Last 8</th>
                                            <th>Diff.</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="text-start ps-3 text-secondary">Points per Game</td>
                                            <td>{{ t2_stats.total.ppg|floatformat:2 }}</td>
                                            <td class="text-info fw-bold">{{ t2_stats.last_8.ppg|floatformat:2 }}</td>
                                            <td
                                                class="{% if t2_stats.diff.ppg >= 0 %}text-success{% else %}text-danger{% endif %} fw-bold">
                                                {{ t2_stats.diff.ppg }}%
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="text-start ps-3 text-secondary">AVG Goals For</td>
                                            <td>{{ t2_stats.total.avg_gf|floatformat:2 }}</td>
                                            <td class="text-info fw-bold">{{ t2_stats.last_8.avg_gf|floatformat:2 }}
                                            </td>
                                            <td
                                                class="{% if t2_stats.diff.avg_gf >= 0 %}text-success{% else %}text-danger{% endif %} fw-bold">
                                                {{ t2_stats.diff.avg_gf }}%
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="text-start ps-3 text-secondary">AVG Goals Against</td>
                                            <td>{{ t2_stats.total.avg_ga|floatformat:2 }}</td>
                                            <td class="text-info fw-bold">{{ t2_stats.last_8.avg_ga|floatformat:2 }}
                                            </td>
                                            <td
                                                class="{% if t2_stats.diff.avg_ga <= 0 %}text-success{% else %}text-danger{% endif %} fw-bold">
                                                {{ t2_stats.diff.avg_ga }}%
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- CONTAINER 3: Progression -->
                    <div class="card border-0 bg-white bg-opacity-10 text-white shadow-sm mb-3">
                        <div class="card-body p-3">
                            <div class="text-secondary small mb-2 fw-bold">{{ team2.name }}'s progression (home & away)
                            </div>
                            <div class="d-flex align-items-center"
                                style="height: 60px; border-bottom: 1px solid rgba(255,255,255,0.1); position: relative;">
                                <div
                                    style="position: absolute; top: 50%; width: 100%; height: 1px; background: rgba(255,255,255,0.2);">
                                </div>
                                {% for m in t2_matches|slice:":20" reversed %}
                                <div class="flex-fill mx-1 d-flex flex-column justify-content-center align-items-center"
                                    style="height: 100%;">
                                    {% if m.home_team == team2 %}
                                    {% if m.home_score > m.away_score %}
                                    <div class="bg-success rounded-1 w-100"
                                        style="height: 60%; transform: translateY(-50%); margin-top: 50%;"
                                        title="Win vs {{ m.away_team.name }}"></div>
                                    {% elif m.home_score == m.away_score %}
                                    <div class="bg-warning rounded-1 w-100" style="height: 15%;"
                                        title="Draw vs {{ m.away_team.name }}"></div>
                                    {% else %}
                                    <div class="bg-danger rounded-1 w-100"
                                        style="height: 40%; transform: translateY(50%); margin-bottom: 50%;"
                                        title="Loss vs {{ m.away_team.name }}"></div>
                                    {% endif %}
                                    {% else %}
                                    {% if m.away_score > m.home_score %}
                                    <div class="bg-success rounded-1 w-100"
                                        style="height: 60%; transform: translateY(-50%); margin-top: 50%;"
                                        title="Win @ {{ m.home_team.name }}"></div>
                                    {% elif m.away_score == m.home_score %}
                                    <div class="bg-warning rounded-1 w-100" style="height: 15%;"
                                        title="Draw @ {{ m.home_team.name }}"></div>
                                    {% else %}
                                    <div class="bg-danger rounded-1 w-100"
                                        style="height: 40%; transform: translateY(50%); margin-bottom: 50%;"
                                        title="Loss @ {{ m.home_team.name }}"></div>
                                    {% endif %}
                                    {% endif %}
                                </div>
                                {% endfor %}
                            </div>
                            <div class="d-flex justify-content-center gap-3 mt-2 small text-secondary">
                                <span class="text-success fw-bold">win:+2</span>
                                <span class="text-warning fw-bold">draw:0</span>
                                <span class="text-danger fw-bold">defeat:-1</span>
                            </div>
                        </div>
                    </div>

                    <!-- CONTAINER 4: Results -->
                    <div class="card border-0 bg-white bg-opacity-10 text-white shadow-sm mb-3">
                        <div class="card-header bg-transparent border-bottom border-secondary border-opacity-25 py-2">
                            <h6 class="mb-0 fw-bold small text-uppercase">Results</h6>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-dark table-hover mb-0 align-middle small">
                                    <thead>
                                        <tr class="text-secondary text-uppercase" style="font-size: 0.7rem;">
                                            <th class="ps-3" colspan="3">Results</th>
                                            <th class="text-center">2.5+</th>
                                            <th class="text-center">CS</th>
                                            <th class="text-center">FTS</th>
                                            <th class="text-center">HT</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for m in t2_matches|slice:":20" %}
                                        {% with is_home=m.home_team|is_team:team2 %}
                                        <tr
                                            class="{% if m.home_score == m.away_score %}bg-warning bg-opacity-10{% elif is_home and m.home_score > m.away_score %}bg-success bg-opacity-10{% elif not is_home and m.away_score > m.home_score %}bg-success bg-opacity-10{% else %}bg-danger bg-opacity-10{% endif %}">
                                            <td class="ps-3 text-secondary" style="width: 50px;">{{ m.date|date:"d M" }}
                                            </td>

                                            <td class="text-end" style="width: 40%;">
                                                {% if is_home %}
                                                <span class="fw-bold">{{ m.home_team.name }}</span>
                                                {% else %}
                                                {{ m.home_team.name }}
                                                {% endif %}
                                            </td>

                                            <td class="text-center px-1" style="width: 40px;">
                                                <span class="bg-white text-dark fw-bold px-1 rounded-1"
                                                    style="font-size: 0.75rem;">
                                                    {{ m.home_score }}:{{ m.away_score }}
                                                </span>
                                            </td>

                                            <td class="text-start" style="width: 40%;">
                                                {% if not is_home %}
                                                <span class="fw-bold">{{ m.away_team.name }}</span>
                                                {% else %}
                                                {{ m.away_team.name }}
                                                {% endif %}
                                            </td>

                                            <td class="text-center text-secondary">{% if m.home_score|add:m.away_score > 2.5 %}<i class="fa-solid fa-check text-info"></i>{% else %}-{% endif %}
                                            </td>
                                            <td class="text-center text-secondary">
                                                {% if is_home and m.away_score == 0 %}<i
                                                    class="fa-solid fa-check text-success"></i>
                                                {% elif not is_home and m.home_score == 0 %}<i
                                                    class="fa-solid fa-check text-success"></i>
                                                {% else %}-{% endif %}
                                            </td>
                                            <td class="text-center text-secondary">
                                                {% if is_home and m.home_score == 0 %}<i
                                                    class="fa-solid fa-check text-danger"></i>
                                                {% elif not is_home and m.away_score == 0 %}<i
                                                    class="fa-solid fa-check text-danger"></i>
                                                {% else %}-{% endif %}
                                            </td>
                                            <td class="text-center text-secondary" style="font-size: 0.7rem;">
                                                {% if m.ht_home_score is not None %}{{ m.ht_home_score }}-{{ m.ht_away_score }}{% else %}-{% endif %}
                                            </td>
                                        </tr>
                                        {% endwith %}
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Key Probabilities -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card border-0 bg-white bg-opacity-10 text-white shadow-sm">
                        <div class="card-header bg-transparent border-bottom border-secondary border-opacity-25 py-3">
                            <h5 class="mb-0 fw-bold"><i class="fa-solid fa-bullseye text-info me-2"></i>Key
                                Probabilities</h5>
                        </div>
                        <div class="card-body">
                            <div class="row text-center g-3">
                                <div class="col-4">
                                    <div class="text-secondary small text-uppercase">Over 2.5</div>
                                    <div class="fw-bold text-info">{{ t1_stats.total.over_25_pct|probability_label:t2_stats.total.over_25_pct }}</div>
                                    <div class="small text-muted">{{ t1_stats.total.over_25_pct }}% / {{ t2_stats.total.over_25_pct }}%</div>
                                </div>
                                <div class="col-4">
                                    <div class="text-secondary small text-uppercase">BTS</div>
                                    <div class="fw-bold text-warning">{{ t1_stats.total.bts_pct|probability_label:t2_stats.total.bts_pct }}</div>
                                    <div class="small text-muted">{{ t1_stats.total.bts_pct }}% / {{ t2_stats.total.bts_pct }}%</div>
                                </div>
                                <div class="col-4">
                                    <div class="text-secondary small text-uppercase">Avg Goals</div>
                                    <div class="fw-bold text-success">{{ h2h_stats.avg_goals|floatformat:1 }}</div>
                                    <div class="small text-muted">H2H Avg</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row g-4">
                <!-- Comparison Stats (Total) -->
                <div class="col-lg-4">
                    <div class="card border-0 bg-white bg-opacity-10 text-white shadow-sm h-100">
                        <div
                            class="card-header bg-transparent border-bottom border-secondary border-opacity-25 py-3 text-center">
                            <h5 class="mb-0 fw-bold text-uppercase small tracking-wide">Overall Season Stats</h5>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-dark table-hover mb-0 align-middle">
                                    <thead>
                                        <tr class="text-secondary small text-uppercase">
                                            <th class="text-center w-25">{{ team1.name }}</th>
                                            <th class="text-center w-50">Metric</th>
                                            <th class="text-center w-25">{{ team2.name }}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="text-center fw-bold">{{ t1_stats.total.ppg|floatformat:2 }}</td>
                                            <td class="text-center text-secondary small">PPG</td>
                                            <td class="text-center fw-bold">{{ t2_stats.total.ppg|floatformat:2 }}</td>
                                        </tr>
                                        <tr>
                                            <td class="text-center">{{ t1_stats.total.gf }}</td>
                                            <td class="text-center text-secondary small">Goals For</td>
                                            <td class="text-center">{{ t2_stats.total.gf }}</td>
                                        </tr>
                                        <tr>
                                            <td class="text-center">{{ t1_stats.total.ga }}</td>
                                            <td class="text-center text-secondary small">Goals Against</td>
                                            <td class="text-center">{{ t2_stats.total.ga }}</td>
                                        </tr>
                                        <tr>
                                            <td class="text-center text-warning">{{ t1_stats.total.bts_pct }}%</td>
                                            <td class="text-center text-secondary small">BTS %</td>
                                            <td class="text-center text-warning">{{ t2_stats.total.bts_pct }}%</td>
                                        </tr>
                                        <tr>
                                            <td class="text-center text-info">{{ t1_stats.total.over_25_pct }}%</td>
                                            <td class="text-center text-secondary small">Over 2.5 %</td>
                                            <td class="text-center text-info">{{ t2_stats.total.over_25_pct }}%</td>
                                        </tr>
                                        <tr>
                                            <td class="text-center text-success">{{ t1_stats.total.cs_pct }}%</td>
                                            <td class="text-center text-secondary small">Clean Sheet %</td>
                                            <td class="text-center text-success">{{ t2_stats.total.cs_pct }}%</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Home vs Away Specifics -->
                <div class="col-lg-4">
                    <div class="card border-0 bg-white bg-opacity-10 text-white shadow-sm h-100">
                        <div
                            class="card-header bg-transparent border-bottom border-secondary border-opacity-25 py-3 text-center">
                            <h5 class="mb-0 fw-bold text-uppercase small tracking-wide">
                                <span class="text-info">Home</span> vs <span class="text-danger">Away</span>
                            </h5>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-dark table-hover mb-0 align-middle">
                                    <thead>
                                        <tr class="text-secondary small text-uppercase">
                                            <th class="text-center w-25">{{ team1.name }}<br><span
                                                    class="badge bg-info bg-opacity-25 text-info border border-info border-opacity-25">Home</span>
                                            </th>
                                            <th class="text-center w-50">Metric</th>
                                            <th class="text-center w-25">{{ team2.name }}<br><span
                                                    class="badge bg-danger bg-opacity-25 text-danger border border-danger border-opacity-25">Away</span>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="text-center fw-bold">{{ t1_stats.home.ppg|floatformat:2 }}</td>
                                            <td class="text-center text-secondary small">PPG</td>
                                            <td class="text-center fw-bold">{{ t2_stats.away.ppg|floatformat:2 }}</td>
                                        </tr>
                                        <tr>
                                            <td class="text-center">{{ t1_stats.home.avg_gf|floatformat:2 }}</td>
                                            <td class="text-center text-secondary small">Avg Scored</td>
                                            <td class="text-center">{{ t2_stats.away.avg_gf|floatformat:2 }}</td>
                                        </tr>
                                        <tr>
                                            <td class="text-center">{{ t1_stats.home.avg_ga|floatformat:2 }}</td>
                                            <td class="text-center text-secondary small">Avg Conceded</td>
                                            <td class="text-center">{{ t2_stats.away.avg_ga|floatformat:2 }}</td>
                                        </tr>
                                        <tr>
                                            <td class="text-center text-warning">{{ t1_stats.home.bts_pct }}%</td>
                                            <td class="text-center text-secondary small">BTS %</td>
                                            <td class="text-center text-warning">{{ t2_stats.away.bts_pct }}%</td>
                                        </tr>
                                        <tr>
                                            <td class="text-center text-info">{{ t1_stats.home.over_25_pct }}%</td>
                                            <td class="text-center text-secondary small">Over 2.5 %</td>
                                            <td class="text-center text-info">{{ t2_stats.away.over_25_pct }}%</td>
                                        </tr>
                                        <tr>
                                            <td class="text-center text-success">{{ t1_stats.home.cs_pct }}%</td>
                                            <td class="text-center text-secondary small">Clean Sheet %</td>
                                            <td class="text-center text-success">{{ t2_stats.away.cs_pct }}%</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent H2H Matches -->
                <div class="col-lg-4">
                    <div class="card border-0 bg-white bg-opacity-10 text-white shadow-sm h-100">
                        <div
                            class="card-header bg-transparent border-bottom border-secondary border-opacity-25 py-3 text-center">
                            <h5 class="mb-0 fw-bold text-uppercase small tracking-wide">Recent H2H</h5>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                                <table class="table table-dark table-hover mb-0 align-middle">
                                    <thead class="sticky-top bg-dark">
                                        <tr class="text-secondary small text-uppercase">
                                            <th class="ps-3">Date</th>
                                            <th class="text-center">Score</th>
                                            <th class="text-end pe-3">Winner</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for match in matches|slice:":8" %}
                                        <tr>
                                            <td class="ps-3 text-secondary small">{{ match.date|date:"M Y" }}</td>
                                            <td class="text-center">
                                                <span
                                                    class="badge bg-dark border border-secondary border-opacity-50 px-2 py-1">
                                                    {{ match.home_score }}-{{ match.away_score }}
                                                </span>
                                            </td>
                                            <td class="text-end pe-3 small">
                                                {% if match.home_score > match.away_score %}
                                                {{ match.home_team.name }}
                                                {% elif match.away_score > match.home_score %}
                                                {{ match.away_team.name }}
                                                {% else %}
                                                Draw
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="3" class="text-center py-4 text-secondary">No recent matches.
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- NEW: Detailed Goals Analysis Grid -->
            <div class="row g-4 mt-1">
                <div class="col-12">
                    <h5 class="text-white fw-bold mb-3"><i class="fa-solid fa-chart-simple text-info me-2"></i>Detailed
                        Goal Stats</h5>
                </div>

                <!-- Over Goals Cards -->
                {% for item in "over_05:Over 0.5,over_15:Over 1.5,over_25:Over 2.5,over_35:Over 3.5"|split:"," %}
                {% with parts=item|split:":" %}
                {% with key=parts.0|add:"_pct" label_text=parts.1 %}
                <div class="col-6 col-md-3">
                    <div class="card border-0 bg-white bg-opacity-10 text-white shadow-sm">
                        <div class="card-body text-center p-3">
                            <div class="text-secondary small text-uppercase mb-2">{{ label_text }} Goals</div>
                            <div class="d-flex justify-content-around align-items-center">
                                <div>
                                    <div class="h4 fw-bold mb-0 text-white">{{ t1_stats.total|get_item:key }}%</div>
                                    <div class="small text-secondary" style="font-size: 0.7rem;">{{ team1.name }}</div>
                                </div>
                                <div class="text-secondary opacity-50">vs</div>
                                <div>
                                    <div class="h4 fw-bold mb-0 text-white">{{ t2_stats.total|get_item:key }}%</div>
                                    <div class="small text-secondary" style="font-size: 0.7rem;">{{ team2.name }}</div>
                                </div>
                            </div>
                            <div class="mt-2 progress" style="height: 4px;">
                                <div class="progress-bar bg-info" role="progressbar" style="width: 0%"
                                    data-width="{{ t1_stats.total|get_item:key }}"></div>
                            </div>
                            <div class="mt-1 progress" style="height: 4px;">
                                <div class="progress-bar bg-danger" role="progressbar" style="width: 0%"
                                    data-width="{{ t2_stats.total|get_item:key }}"></div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endwith %}
                {% endwith %}
                {% endfor %}
            </div>

            <!-- Points Per Game (Remaining Matches Analysis) -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card border-0 bg-white bg-opacity-10 text-white shadow-sm">
                        <div class="card-header bg-transparent border-bottom border-secondary border-opacity-25 py-3">
                            <h5 class="mb-0 fw-bold"><i class="fa-solid fa-calendar-check text-warning me-2"></i>Points
                                Per Game (Remaining Matches Analysis)</h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-4">
                                <!-- Team 1 Remaining -->
                                <div class="col-lg-6">
                                    <h6 class="text-info mb-3 fw-bold">{{ team1.name }} Upcoming</h6>
                                    <div class="table-responsive">
                                        <table class="table table-dark table-hover mb-0 align-middle small">
                                            <thead>
                                                <tr class="text-secondary text-uppercase" style="font-size: 0.7rem;">
                                                    <th>Date</th>
                                                    <th class="text-center">Match</th>
                                                    <th class="text-center">Home</th>
                                                    <th class="text-center">Away</th>
                                                    <th class="text-center">Opp</th>
                                                    <th>Analysis</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for item in t1_fixtures|slice:":10" %}
                                                <tr>
                                                    <td class="text-secondary">{{ item.match.date|date:"d M" }}</td>
                                                    <td class="text-center">
                                                        {% if item.is_home %}
                                                        <span class="fw-bold text-white">{{ item.match.home_team.name }}</span> <span class="text-muted">vs</span> {{ item.match.away_team.name }}
                                                        {% else %}
                                                        {{ item.match.home_team.name }} <span
                                                            class="text-muted">vs</span> <span
                                                            class="fw-bold text-white">{{ item.match.away_team.name }}</span>
                                                        {% endif %}
                                                    </td>
                                                    <td class="text-center text-secondary">{% if item.is_home %}{{ item.my_ppg|floatformat:2 }}{% else %}-{% endif %}</td>
                                                    <td class="text-center text-secondary">{% if not item.is_home %}{{ item.my_ppg|floatformat:2 }}{% else %}-{% endif %}</td>
                                                    <td class="text-center fw-bold text-info">{{ item.opp_ppg|floatformat:2 }}</td>
                                                    <td style="width: 80px;">
                                                        <div class="progress" style="height: 6px;">
                                                            <div class="progress-bar bg-info" role="progressbar"
                                                                style="width: 0%" data-width="{{ item.bar_width }}">
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                {% empty %}
                                                <tr>
                                                    <td colspan="6" class="text-center text-muted">No upcoming matches.
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                                <tr class="table-active border-top border-secondary">
                                                    <td colspan="4" class="text-end fw-bold text-white">Avg Opponent
                                                        PPG:</td>
                                                    <td class="text-center fw-bold text-warning">{{ t1_avg_opp_ppg|floatformat:2 }}</td>
                                                    <td></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Team 2 Remaining -->
                                <div class="col-lg-6">
                                    <h6 class="text-danger mb-3 fw-bold">{{ team2.name }} Upcoming</h6>
                                    <div class="table-responsive">
                                        <table class="table table-dark table-hover mb-0 align-middle small">
                                            <thead>
                                                <tr class="text-secondary text-uppercase" style="font-size: 0.7rem;">
                                                    <th>Date</th>
                                                    <th class="text-center">Match</th>
                                                    <th class="text-center">Home</th>
                                                    <th class="text-center">Away</th>
                                                    <th class="text-center">Opp</th>
                                                    <th>Analysis</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for item in t2_fixtures|slice:":10" %}
                                                <tr>
                                                    <td class="text-secondary">{{ item.match.date|date:"d M" }}</td>
                                                    <td class="text-center">
                                                        {% if item.is_home %}
                                                        <span class="fw-bold text-white">{{ item.match.home_team.name }}</span> <span class="text-muted">vs</span> {{ item.match.away_team.name }}
                                                        {% else %}
                                                        {{ item.match.home_team.name }} <span
                                                            class="text-muted">vs</span> <span
                                                            class="fw-bold text-white">{{ item.match.away_team.name }}</span>
                                                        {% endif %}
                                                    </td>
                                                    <td class="text-center text-secondary">{% if item.is_home %}{{ item.my_ppg|floatformat:2 }}{% else %}-{% endif %}</td>
                                                    <td class="text-center text-secondary">{% if not item.is_home %}{{ item.my_ppg|floatformat:2 }}{% else %}-{% endif %}</td>
                                                    <td class="text-center fw-bold text-info">{{ item.opp_ppg|floatformat:2 }}</td>
                                                    <td style="width: 80px;">
                                                        <div class="progress" style="height: 6px;">
                                                            <div class="progress-bar bg-info" role="progressbar"
                                                                style="width: 0%" data-width="{{ item.bar_width }}">
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                {% empty %}
                                                <tr>
                                                    <td colspan="6" class="text-center text-muted">No upcoming matches.
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                                <tr class="table-active border-top border-secondary">
                                                    <td colspan="4" class="text-end fw-bold text-white">Avg Opponent
                                                        PPG:</td>
                                                    <td class="text-center fw-bold text-warning">{{ t2_avg_opp_ppg|floatformat:2 }}</td>
                                                    <td></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>










        <!-- Direct Head-to-Head History -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card border-0 bg-white bg-opacity-10 text-white shadow-sm">
                    <div class="card-header bg-transparent border-bottom border-secondary border-opacity-25 py-3">
                        <h5 class="mb-0 fw-bold">Direct Head-to-Head History</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <!-- Summary Stats -->
                            <div class="col-lg-4 mb-3 mb-lg-0">
                                <div
                                    class="p-3 border border-secondary border-opacity-25 rounded bg-dark bg-opacity-25 h-100">
                                    <h6
                                        class="text-secondary text-uppercase small fw-bold mb-3 border-bottom border-secondary border-opacity-25 pb-2">
                                        Summary</h6>
                                    <div class="d-flex justify-content-between mb-2 small fw-bold text-secondary">
                                        <span>{{ team1.name }} Wins</span>
                                        <span>Draws</span>
                                        <span>{{ team2.name }} Wins</span>
                                    </div>
                                    <div class="progress mb-2" style="height: 20px;">
                                        {% if h2h_stats.gp > 0 %}
                                        <div class="progress-bar bg-success" role="progressbar" style="width: 0%"
                                            data-width="{{ h2h_stats.t1_win_pct }}"
                                            title="{{ h2h_stats.t1_wins }} Wins"></div>
                                        <div class="progress-bar bg-warning text-dark" role="progressbar"
                                            style="width: 0%" data-width="{{ h2h_stats.draw_pct }}"
                                            title="{{ h2h_stats.draws }} Draws"></div>
                                        <div class="progress-bar bg-danger" role="progressbar" style="width: 0%"
                                            data-width="{{ h2h_stats.t2_win_pct }}"
                                            title="{{ h2h_stats.t2_wins }} Wins"></div>
                                        {% else %}
                                        <div class="w-100 text-center text-secondary small align-self-center">No Data
                                        </div>
                                        {% endif %}
                                    </div>
                                    <div class="d-flex justify-content-between small fw-bold mb-3">
                                        <span class="text-success">{{ h2h_stats.t1_wins }}</span>
                                        <span class="text-warning">{{ h2h_stats.draws }}</span>
                                        <span class="text-danger">{{ h2h_stats.t2_wins }}</span>
                                    </div>
                                    <div
                                        class="text-center mt-3 small text-secondary border-top border-secondary border-opacity-25 pt-3">
                                        <div class="mb-2">Total Matches: <strong class="text-white">{{ h2h_stats.gp }}</strong></div>
                                        <div class="mb-2">Total Goals: <strong class="text-white">{{ h2h_stats.t1_goals|add:h2h_stats.t2_goals }}</strong></div>
                                        <div>Avg Goals: <strong class="text-white">{{ h2h_stats.avg_goals }}</strong>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Matches Table -->
                            <div class="col-lg-8">
                                <div class="table-responsive custom-scrollbar"
                                    style="max-height: 300px; overflow-y: auto;">
                                    <table class="table table-dark table-hover mb-0 align-middle small">
                                        <thead class="sticky-top bg-dark">
                                            <tr class="text-secondary border-bottom border-secondary border-opacity-25">
                                                <th>Date</th>
                                                <th class="text-end">Home</th>
                                                <th class="text-center">Score</th>
                                                <th class="text-start">Away</th>
                                                <th>Comp.</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for m in matches %}
                                            {% with is_t1_home=m.home_team|is_team:team1 %}
                                            <tr
                                                class="{% if m.home_score == m.away_score %}bg-warning bg-opacity-10{% elif is_t1_home and m.home_score > m.away_score %}bg-success bg-opacity-10{% elif not is_t1_home and m.away_score > m.home_score %}bg-success bg-opacity-10{% else %}bg-danger bg-opacity-10{% endif %}">
                                                <td class="text-secondary" style="white-space: nowrap;">{{ m.date|date:"d/m/y" }}</td>

                                                {% if is_t1_home %}
                                                <td class="text-end fw-bold text-white text-truncate"
                                                    style="max-width: 120px;" title="{{ m.home_team.name }}">{{ m.home_team.name }}</td>
                                                <td class="text-center fw-bold" style="white-space: nowrap;">
                                                    <span
                                                        class="bg-white text-dark px-2 py-1 rounded-1 border border-secondary"
                                                        style="font-size: 0.75rem;">{{ m.home_score }}-{{ m.away_score }}</span>
                                                </td>
                                                <td class="text-start text-secondary text-truncate"
                                                    style="max-width: 120px;" title="{{ m.away_team.name }}">{{ m.away_team.name }}</td>
                                                {% else %}
                                                <td class="text-end text-secondary text-truncate"
                                                    style="max-width: 120px;" title="{{ m.home_team.name }}">{{ m.home_team.name }}</td>
                                                <td class="text-center fw-bold" style="white-space: nowrap;">
                                                    <span
                                                        class="bg-white text-dark px-2 py-1 rounded-1 border border-secondary"
                                                        style="font-size: 0.75rem;">{{ m.home_score }}-{{ m.away_score }}</span>
                                                </td>
                                                <td class="text-start fw-bold text-white text-truncate"
                                                    style="max-width: 120px;" title="{{ m.away_team.name }}">{{ m.away_team.name }}</td>
                                                {% endif %}

                                                <td class="text-secondary text-truncate" style="max-width: 100px;"
                                                    title="{{ m.league.name }}">{{ m.league.name }}</td>
                                            </tr>
                                            {% endwith %}
                                            {% empty %}
                                            <tr>
                                                <td colspan="5" class="text-center text-secondary py-3">No recorded
                                                    matches between these teams.</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Historical Statistics & Comparison with Past Seasons -->
        <div class="row mt-4">
            <!-- Team 1 -->
            <div class="col-md-6">
                <div class="card border-0 bg-white bg-opacity-10 text-white shadow-sm h-100">
                    <div class="card-header bg-transparent border-bottom border-secondary border-opacity-25 py-3">
                        <h5 class="mb-0 fw-bold">Historical statistics</h5>
                    </div>
                    <div class="card-body">
                        <!-- Historical Stats -->
                        <div class="p-3 mb-4 border border-secondary border-opacity-25 rounded bg-dark bg-opacity-25">
                            <div
                                class="d-flex align-items-center mb-3 pb-2 border-bottom border-secondary border-opacity-25">
                                <img src="{{ team1.logo_url }}" class="me-2" style="height: 20px;">
                                <span class="fw-bold">{{ team1.name }}</span>
                                <span class="ms-2 small text-secondary">(current vs previous)</span>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-dark table-sm table-borderless mb-0 small text-center">
                                    <thead class="text-secondary">
                                        <tr>
                                            <th class="text-start">Season</th>
                                            <th>Pld</th>
                                            <th>Avg Pts</th>
                                            <th>Avg GF</th>
                                            <th>Avg GA</th>
                                            <th>W</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Total -->
                                        <tr>
                                            <td class="text-start fw-bold">{{ latest_season.year }}</td>
                                            <td class="fw-bold">{{ t1_stats.total.gp }}</td>
                                            <td
                                                class="fw-bold {% if t1_prev_stats and t1_stats.total.ppg > t1_prev_stats.total.ppg %}text-success{% elif t1_prev_stats and t1_stats.total.ppg < t1_prev_stats.total.ppg %}text-danger{% endif %}">
                                                {{ t1_stats.total.ppg|floatformat:2 }}</td>
                                            <td class="text-info">{{ t1_stats.total.avg_gf|floatformat:2 }}</td>
                                            <td class="text-danger">{{ t1_stats.total.avg_ga|floatformat:2 }}</td>
                                            <td class="text-success">{{ t1_stats.total.win_pct }}%</td>
                                        </tr>
                                        {% if t1_prev_stats %}
                                        <tr class="text-secondary">
                                            <td class="text-start">{{ t1_prev_season.year }}</td>
                                            <td>{{ t1_prev_stats.total.gp }}</td>
                                            <td>{{ t1_prev_stats.total.ppg|floatformat:2 }}</td>
                                            <td>{{ t1_prev_stats.total.avg_gf|floatformat:2 }}</td>
                                            <td>{{ t1_prev_stats.total.avg_ga|floatformat:2 }}</td>
                                            <td>{{ t1_prev_stats.total.win_pct }}%</td>
                                        </tr>
                                        {% endif %}
                                        <tr>
                                            <td colspan="6" class="py-2"></td>
                                        </tr>
                                        <!-- Home -->
                                        <tr>
                                            <td class="text-start fw-bold">{{ latest_season.year }} (home)</td>
                                            <td class="fw-bold">{{ t1_stats.home.gp }}</td>
                                            <td
                                                class="fw-bold {% if t1_prev_stats and t1_stats.home.ppg > t1_prev_stats.home.ppg %}text-success{% elif t1_prev_stats and t1_stats.home.ppg < t1_prev_stats.home.ppg %}text-danger{% endif %}">
                                                {{ t1_stats.home.ppg|floatformat:2 }}</td>
                                            <td class="text-info">{{ t1_stats.home.avg_gf|floatformat:2 }}</td>
                                            <td class="text-danger">{{ t1_stats.home.avg_ga|floatformat:2 }}</td>
                                            <td class="text-success">{{ t1_stats.home.win_pct }}%</td>
                                        </tr>
                                        {% if t1_prev_stats %}
                                        <tr class="text-secondary">
                                            <td class="text-start">{{ t1_prev_season.year }} (home)</td>
                                            <td>{{ t1_prev_stats.home.gp }}</td>
                                            <td>{{ t1_prev_stats.home.ppg|floatformat:2 }}</td>
                                            <td>{{ t1_prev_stats.home.avg_gf|floatformat:2 }}</td>
                                            <td>{{ t1_prev_stats.home.avg_ga|floatformat:2 }}</td>
                                            <td>{{ t1_prev_stats.home.win_pct }}%</td>
                                        </tr>
                                        {% endif %}
                                        <tr>
                                            <td colspan="6" class="py-2"></td>
                                        </tr>
                                        <!-- Away -->
                                        <tr>
                                            <td class="text-start fw-bold">{{ latest_season.year }} (away)</td>
                                            <td class="fw-bold">{{ t1_stats.away.gp }}</td>
                                            <td
                                                class="fw-bold {% if t1_prev_stats and t1_stats.away.ppg > t1_prev_stats.away.ppg %}text-success{% elif t1_prev_stats and t1_stats.away.ppg < t1_prev_stats.away.ppg %}text-danger{% endif %}">
                                                {{ t1_stats.away.ppg|floatformat:2 }}</td>
                                            <td class="text-info">{{ t1_stats.away.avg_gf|floatformat:2 }}</td>
                                            <td class="text-danger">{{ t1_stats.away.avg_ga|floatformat:2 }}</td>
                                            <td class="text-success">{{ t1_stats.away.win_pct }}%</td>
                                        </tr>
                                        {% if t1_prev_stats %}
                                        <tr class="text-secondary">
                                            <td class="text-start">{{ t1_prev_season.year }} (away)</td>
                                            <td>{{ t1_prev_stats.away.gp }}</td>
                                            <td>{{ t1_prev_stats.away.ppg|floatformat:2 }}</td>
                                            <td>{{ t1_prev_stats.away.avg_gf|floatformat:2 }}</td>
                                            <td>{{ t1_prev_stats.away.avg_ga|floatformat:2 }}</td>
                                            <td>{{ t1_prev_stats.away.win_pct }}%</td>
                                        </tr>
                                        {% endif %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Comparison with Past Seasons -->
                        <div class="p-3 border border-secondary border-opacity-25 rounded bg-dark bg-opacity-25">
                            <div
                                class="d-flex align-items-center mb-3 pb-2 border-bottom border-secondary border-opacity-25">
                                <h6 class="mb-0 fw-bold">Comparison with past seasons</h6>
                            </div>
                            <div class="mb-3 small text-secondary">
                                {{ team1.name }}'s record after {{ t1_stats.total.gp }} matches
                            </div>
                            <div class="table-responsive">
                                <table class="table table-dark table-sm table-borderless mb-0 small text-center">
                                    <thead class="text-secondary">
                                        <tr>
                                            <th class="text-start">Season</th>
                                            <th>GP</th>
                                            <th>W</th>
                                            <th>D</th>
                                            <th>L</th>
                                            <th>GF</th>
                                            <th>GA</th>
                                            <th>Pts</th>
                                            <th>Diff</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for rec in t1_past_records %}
                                        <tr
                                            class="{% if rec.season == latest_season %}bg-white bg-opacity-10 fw-bold{% endif %}">
                                            <td class="text-start">{{ rec.season.year }}</td>
                                            <td>{{ rec.gp }}</td>
                                            <td class="text-success">{{ rec.w }}</td>
                                            <td>{{ rec.d }}</td>
                                            <td class="text-danger">{{ rec.l }}</td>
                                            <td class="text-info">{{ rec.gf }}</td>
                                            <td class="text-danger">{{ rec.ga }}</td>
                                            <td class="fw-bold">{{ rec.pts }}</td>
                                            {% if rec.season == latest_season %}
                                            <td>-</td>
                                            {% else %}
                                            <td
                                                class="{% if rec.diff > 0 %}text-success{% elif rec.diff < 0 %}text-danger{% else %}text-secondary{% endif %} fw-bold">
                                                {% if rec.diff > 0 %}+{{ rec.diff }}{% else %}{{ rec.diff }}{% endif %}
                                            </td>
                                            {% endif %}
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Team 2 -->
            <div class="col-md-6">
                <div class="card border-0 bg-white bg-opacity-10 text-white shadow-sm h-100">
                    <div class="card-header bg-transparent border-bottom border-secondary border-opacity-25 py-3">
                        <h5 class="mb-0 fw-bold">Historical statistics</h5>
                    </div>
                    <div class="card-body">
                        <!-- Historical Stats -->
                        <div class="p-3 mb-4 border border-secondary border-opacity-25 rounded bg-dark bg-opacity-25">
                            <div
                                class="d-flex align-items-center mb-3 pb-2 border-bottom border-secondary border-opacity-25">
                                <img src="{{ team2.logo_url }}" class="me-2" style="height: 20px;">
                                <span class="fw-bold">{{ team2.name }}</span>
                                <span class="ms-2 small text-secondary">(current vs previous)</span>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-dark table-sm table-borderless mb-0 small text-center">
                                    <thead class="text-secondary">
                                        <tr>
                                            <th class="text-start">Season</th>
                                            <th>Pld</th>
                                            <th>Avg Pts</th>
                                            <th>Avg GF</th>
                                            <th>Avg GA</th>
                                            <th>W</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Total -->
                                        <tr>
                                            <td class="text-start fw-bold">{{ latest_season.year }}</td>
                                            <td class="fw-bold">{{ t2_stats.total.gp }}</td>
                                            <td
                                                class="fw-bold {% if t2_prev_stats and t2_stats.total.ppg > t2_prev_stats.total.ppg %}text-success{% elif t2_prev_stats and t2_stats.total.ppg < t2_prev_stats.total.ppg %}text-danger{% endif %}">
                                                {{ t2_stats.total.ppg|floatformat:2 }}</td>
                                            <td class="text-info">{{ t2_stats.total.avg_gf|floatformat:2 }}</td>
                                            <td class="text-danger">{{ t2_stats.total.avg_ga|floatformat:2 }}</td>
                                            <td class="text-success">{{ t2_stats.total.win_pct }}%</td>
                                        </tr>
                                        {% if t2_prev_stats %}
                                        <tr class="text-secondary">
                                            <td class="text-start">{{ t2_prev_season.year }}</td>
                                            <td>{{ t2_prev_stats.total.gp }}</td>
                                            <td>{{ t2_prev_stats.total.ppg|floatformat:2 }}</td>
                                            <td>{{ t2_prev_stats.total.avg_gf|floatformat:2 }}</td>
                                            <td>{{ t2_prev_stats.total.avg_ga|floatformat:2 }}</td>
                                            <td>{{ t2_prev_stats.total.win_pct }}%</td>
                                        </tr>
                                        {% endif %}
                                        <tr>
                                            <td colspan="6" class="py-2"></td>
                                        </tr>
                                        <!-- Home -->
                                        <tr>
                                            <td class="text-start fw-bold">{{ latest_season.year }} (home)</td>
                                            <td class="fw-bold">{{ t2_stats.home.gp }}</td>
                                            <td
                                                class="fw-bold {% if t2_prev_stats and t2_stats.home.ppg > t2_prev_stats.home.ppg %}text-success{% elif t2_prev_stats and t2_stats.home.ppg < t2_prev_stats.home.ppg %}text-danger{% endif %}">
                                                {{ t2_stats.home.ppg|floatformat:2 }}</td>
                                            <td class="text-info">{{ t2_stats.home.avg_gf|floatformat:2 }}</td>
                                            <td class="text-danger">{{ t2_stats.home.avg_ga|floatformat:2 }}</td>
                                            <td class="text-success">{{ t2_stats.home.win_pct }}%</td>
                                        </tr>
                                        {% if t2_prev_stats %}
                                        <tr class="text-secondary">
                                            <td class="text-start">{{ t2_prev_season.year }} (home)</td>
                                            <td>{{ t2_prev_stats.home.gp }}</td>
                                            <td>{{ t2_prev_stats.home.ppg|floatformat:2 }}</td>
                                            <td>{{ t2_prev_stats.home.avg_gf|floatformat:2 }}</td>
                                            <td>{{ t2_prev_stats.home.avg_ga|floatformat:2 }}</td>
                                            <td>{{ t2_prev_stats.home.win_pct }}%</td>
                                        </tr>
                                        {% endif %}
                                        <tr>
                                            <td colspan="6" class="py-2"></td>
                                        </tr>
                                        <!-- Away -->
                                        <tr>
                                            <td class="text-start fw-bold">{{ latest_season.year }} (away)</td>
                                            <td class="fw-bold">{{ t2_stats.away.gp }}</td>
                                            <td
                                                class="fw-bold {% if t2_prev_stats and t2_stats.away.ppg > t2_prev_stats.away.ppg %}text-success{% elif t2_prev_stats and t2_stats.away.ppg < t2_prev_stats.away.ppg %}text-danger{% endif %}">
                                                {{ t2_stats.away.ppg|floatformat:2 }}</td>
                                            <td class="text-info">{{ t2_stats.away.avg_gf|floatformat:2 }}</td>
                                            <td class="text-danger">{{ t2_stats.away.avg_ga|floatformat:2 }}</td>
                                            <td class="text-success">{{ t2_stats.away.win_pct }}%</td>
                                        </tr>
                                        {% if t2_prev_stats %}
                                        <tr class="text-secondary">
                                            <td class="text-start">{{ t2_prev_season.year }} (away)</td>
                                            <td>{{ t2_prev_stats.away.gp }}</td>
                                            <td>{{ t2_prev_stats.away.ppg|floatformat:2 }}</td>
                                            <td>{{ t2_prev_stats.away.avg_gf|floatformat:2 }}</td>
                                            <td>{{ t2_prev_stats.away.avg_ga|floatformat:2 }}</td>
                                            <td>{{ t2_prev_stats.away.win_pct }}%</td>
                                        </tr>
                                        {% endif %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Comparison with Past Seasons -->
                        <div class="p-3 border border-secondary border-opacity-25 rounded bg-dark bg-opacity-25">
                            <div
                                class="d-flex align-items-center mb-3 pb-2 border-bottom border-secondary border-opacity-25">
                                <h6 class="mb-0 fw-bold">Comparison with past seasons</h6>
                            </div>
                            <div class="mb-3 small text-secondary">
                                {{ team2.name }}'s record after {{ t2_stats.total.gp }} matches
                            </div>
                            <div class="table-responsive">
                                <table class="table table-dark table-sm table-borderless mb-0 small text-center">
                                    <thead class="text-secondary">
                                        <tr>
                                            <th class="text-start">Season</th>
                                            <th>GP</th>
                                            <th>W</th>
                                            <th>D</th>
                                            <th>L</th>
                                            <th>GF</th>
                                            <th>GA</th>
                                            <th>Pts</th>
                                            <th>Diff</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for rec in t2_past_records %}
                                        <tr
                                            class="{% if rec.season == latest_season %}bg-white bg-opacity-10 fw-bold{% endif %}">
                                            <td class="text-start">{{ rec.season.year }}</td>
                                            <td>{{ rec.gp }}</td>
                                            <td class="text-success">{{ rec.w }}</td>
                                            <td>{{ rec.d }}</td>
                                            <td class="text-danger">{{ rec.l }}</td>
                                            <td class="text-info">{{ rec.gf }}</td>
                                            <td class="text-danger">{{ rec.ga }}</td>
                                            <td class="fw-bold">{{ rec.pts }}</td>
                                            {% if rec.season == latest_season %}
                                            <td>-</td>
                                            {% else %}
                                            <td
                                                class="{% if rec.diff > 0 %}text-success{% elif rec.diff < 0 %}text-danger{% else %}text-secondary{% endif %} fw-bold">
                                                {% if rec.diff > 0 %}+{{ rec.diff }}{% else %}{{ rec.diff }}{% endif %}
                                            </td>
                                            {% endif %}
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Current Streaks & Sequences -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card border-0 bg-white bg-opacity-10 text-white shadow-sm">
                    <div class="card-header bg-transparent border-bottom border-secondary border-opacity-25 py-3">
                        <h5 class="mb-0 fw-bold"><i class="fa-solid fa-fire text-warning me-2"></i>Current streaks &
                            sequences</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-4">
                            <!-- Team 1 -->
                            <div class="col-md-6">
                                <div
                                    class="p-3 border border-secondary border-opacity-25 rounded bg-dark bg-opacity-25 h-100">
                                    <div
                                        class="d-flex align-items-center mb-3 pb-2 border-bottom border-secondary border-opacity-25">
                                        <img src="{{ team1.logo_url }}" class="me-2" style="height: 24px;">
                                        <h6 class="mb-0 fw-bold">{{ team1.name }}</h6>
                                    </div>
                                    <div class="table-responsive">
                                        <table
                                            class="table table-dark table-sm table-borderless mb-0 align-middle small text-center">
                                            <thead>
                                                <tr
                                                    class="text-secondary border-bottom border-secondary border-opacity-25">
                                                    <th class="text-start">Statistic</th>
                                                    <th>Home</th>
                                                    <th>Away</th>
                                                    <th>Total</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% with s=t1_streaks %}
                                                <tr>
                                                    <td class="text-start text-secondary">Wins</td>
                                                    <td class="{% if s.home.wins > 0 %}text-success fw-bold{% endif %}">
                                                        {% if s.home.wins > 0 %}{{ s.home.wins }}{% else %}-{% endif %}
                                                    </td>
                                                    <td class="{% if s.away.wins > 0 %}text-success fw-bold{% endif %}">
                                                        {% if s.away.wins > 0 %}{{ s.away.wins }}{% else %}-{% endif %}
                                                    </td>
                                                    <td
                                                        class="{% if s.total.wins > 0 %}text-success fw-bold{% endif %}">
                                                        {% if s.total.wins > 0 %}{{ s.total.wins }}{% else %}-{% endif %}</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-start text-secondary">Draws</td>
                                                    <td
                                                        class="{% if s.home.draws > 0 %}text-warning fw-bold{% endif %}">
                                                        {% if s.home.draws > 0 %}{{ s.home.draws }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.away.draws > 0 %}text-warning fw-bold{% endif %}">
                                                        {% if s.away.draws > 0 %}{{ s.away.draws }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.total.draws > 0 %}text-warning fw-bold{% endif %}">
                                                        {% if s.total.draws > 0 %}{{ s.total.draws }}{% else %}-{% endif %}</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-start text-secondary">Defeats</td>
                                                    <td
                                                        class="{% if s.home.defeats > 0 %}text-danger fw-bold{% endif %}">
                                                        {% if s.home.defeats > 0 %}{{ s.home.defeats }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.away.defeats > 0 %}text-danger fw-bold{% endif %}">
                                                        {% if s.away.defeats > 0 %}{{ s.away.defeats }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.total.defeats > 0 %}text-danger fw-bold{% endif %}">
                                                        {% if s.total.defeats > 0 %}{{ s.total.defeats }}{% else %}-{% endif %}</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-start text-secondary">No win</td>
                                                    <td
                                                        class="{% if s.home.no_win > 0 %}text-danger fw-bold{% endif %}">
                                                        {% if s.home.no_win > 0 %}{{ s.home.no_win }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.away.no_win > 0 %}text-danger fw-bold{% endif %}">
                                                        {% if s.away.no_win > 0 %}{{ s.away.no_win }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.total.no_win > 0 %}text-danger fw-bold{% endif %}">
                                                        {% if s.total.no_win > 0 %}{{ s.total.no_win }}{% else %}-{% endif %}</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-start text-secondary">No draw</td>
                                                    <td>{% if s.home.no_draw > 0 %}{{ s.home.no_draw }}{% else %}-{% endif %}</td>
                                                    <td>{% if s.away.no_draw > 0 %}{{ s.away.no_draw }}{% else %}-{% endif %}</td>
                                                    <td>{% if s.total.no_draw > 0 %}{{ s.total.no_draw }}{% else %}-{% endif %}</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-start text-secondary">No defeat</td>
                                                    <td
                                                        class="{% if s.home.no_defeat > 0 %}text-success fw-bold{% endif %}">
                                                        {% if s.home.no_defeat > 0 %}{{ s.home.no_defeat }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.away.no_defeat > 0 %}text-success fw-bold{% endif %}">
                                                        {% if s.away.no_defeat > 0 %}{{ s.away.no_defeat }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.total.no_defeat > 0 %}text-success fw-bold{% endif %}">
                                                        {% if s.total.no_defeat > 0 %}{{ s.total.no_defeat }}{% else %}-{% endif %}</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-start text-secondary">Scored 1+ goals</td>
                                                    <td
                                                        class="{% if s.home.score_1plus > 0 %}text-success fw-bold{% endif %}">
                                                        {% if s.home.score_1plus > 0 %}{{ s.home.score_1plus }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.away.score_1plus > 0 %}text-success fw-bold{% endif %}">
                                                        {% if s.away.score_1plus > 0 %}{{ s.away.score_1plus }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.total.score_1plus > 0 %}text-success fw-bold{% endif %}">
                                                        {% if s.total.score_1plus > 0 %}{{ s.total.score_1plus }}{% else %}-{% endif %}</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-start text-secondary">Conceded 1+ goals</td>
                                                    <td
                                                        class="{% if s.home.concede_1plus > 0 %}text-danger fw-bold{% endif %}">
                                                        {% if s.home.concede_1plus > 0 %}{{ s.home.concede_1plus }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.away.concede_1plus > 0 %}text-danger fw-bold{% endif %}">
                                                        {% if s.away.concede_1plus > 0 %}{{ s.away.concede_1plus }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.total.concede_1plus > 0 %}text-danger fw-bold{% endif %}">
                                                        {% if s.total.concede_1plus > 0 %}{{ s.total.concede_1plus }}{% else %}-{% endif %}</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-start text-secondary">Did not score</td>
                                                    <td
                                                        class="{% if s.home.no_score > 0 %}text-danger fw-bold{% endif %}">
                                                        {% if s.home.no_score > 0 %}{{ s.home.no_score }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.away.no_score > 0 %}text-danger fw-bold{% endif %}">
                                                        {% if s.away.no_score > 0 %}{{ s.away.no_score }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.total.no_score > 0 %}text-danger fw-bold{% endif %}">
                                                        {% if s.total.no_score > 0 %}{{ s.total.no_score }}{% else %}-{% endif %}</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-start text-secondary">Did not concede</td>
                                                    <td
                                                        class="{% if s.home.no_concede > 0 %}text-success fw-bold{% endif %}">
                                                        {% if s.home.no_concede > 0 %}{{ s.home.no_concede }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.away.no_concede > 0 %}text-success fw-bold{% endif %}">
                                                        {% if s.away.no_concede > 0 %}{{ s.away.no_concede }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.total.no_concede > 0 %}text-success fw-bold{% endif %}">
                                                        {% if s.total.no_concede > 0 %}{{ s.total.no_concede }}{% else %}-{% endif %}</td>
                                                </tr>
                                                {% endwith %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- Team 2 -->
                            <div class="col-md-6">
                                <div
                                    class="p-3 border border-secondary border-opacity-25 rounded bg-dark bg-opacity-25 h-100">
                                    <div
                                        class="d-flex align-items-center mb-3 pb-2 border-bottom border-secondary border-opacity-25">
                                        <img src="{{ team2.logo_url }}" class="me-2" style="height: 24px;">
                                        <h6 class="mb-0 fw-bold">{{ team2.name }}</h6>
                                    </div>
                                    <div class="table-responsive">
                                        <table
                                            class="table table-dark table-sm table-borderless mb-0 align-middle small text-center">
                                            <thead>
                                                <tr
                                                    class="text-secondary border-bottom border-secondary border-opacity-25">
                                                    <th class="text-start">Statistic</th>
                                                    <th>Home</th>
                                                    <th>Away</th>
                                                    <th>Total</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% with s=t2_streaks %}
                                                <tr>
                                                    <td class="text-start text-secondary">Wins</td>
                                                    <td class="{% if s.home.wins > 0 %}text-success fw-bold{% endif %}">
                                                        {% if s.home.wins > 0 %}{{ s.home.wins }}{% else %}-{% endif %}
                                                    </td>
                                                    <td class="{% if s.away.wins > 0 %}text-success fw-bold{% endif %}">
                                                        {% if s.away.wins > 0 %}{{ s.away.wins }}{% else %}-{% endif %}
                                                    </td>
                                                    <td
                                                        class="{% if s.total.wins > 0 %}text-success fw-bold{% endif %}">
                                                        {% if s.total.wins > 0 %}{{ s.total.wins }}{% else %}-{% endif %}</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-start text-secondary">Draws</td>
                                                    <td
                                                        class="{% if s.home.draws > 0 %}text-warning fw-bold{% endif %}">
                                                        {% if s.home.draws > 0 %}{{ s.home.draws }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.away.draws > 0 %}text-warning fw-bold{% endif %}">
                                                        {% if s.away.draws > 0 %}{{ s.away.draws }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.total.draws > 0 %}text-warning fw-bold{% endif %}">
                                                        {% if s.total.draws > 0 %}{{ s.total.draws }}{% else %}-{% endif %}</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-start text-secondary">Defeats</td>
                                                    <td
                                                        class="{% if s.home.defeats > 0 %}text-danger fw-bold{% endif %}">
                                                        {% if s.home.defeats > 0 %}{{ s.home.defeats }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.away.defeats > 0 %}text-danger fw-bold{% endif %}">
                                                        {% if s.away.defeats > 0 %}{{ s.away.defeats }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.total.defeats > 0 %}text-danger fw-bold{% endif %}">
                                                        {% if s.total.defeats > 0 %}{{ s.total.defeats }}{% else %}-{% endif %}</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-start text-secondary">No win</td>
                                                    <td
                                                        class="{% if s.home.no_win > 0 %}text-danger fw-bold{% endif %}">
                                                        {% if s.home.no_win > 0 %}{{ s.home.no_win }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.away.no_win > 0 %}text-danger fw-bold{% endif %}">
                                                        {% if s.away.no_win > 0 %}{{ s.away.no_win }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.total.no_win > 0 %}text-danger fw-bold{% endif %}">
                                                        {% if s.total.no_win > 0 %}{{ s.total.no_win }}{% else %}-{% endif %}</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-start text-secondary">No draw</td>
                                                    <td>{% if s.home.no_draw > 0 %}{{ s.home.no_draw }}{% else %}-{% endif %}</td>
                                                    <td>{% if s.away.no_draw > 0 %}{{ s.away.no_draw }}{% else %}-{% endif %}</td>
                                                    <td>{% if s.total.no_draw > 0 %}{{ s.total.no_draw }}{% else %}-{% endif %}</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-start text-secondary">No defeat</td>
                                                    <td
                                                        class="{% if s.home.no_defeat > 0 %}text-success fw-bold{% endif %}">
                                                        {% if s.home.no_defeat > 0 %}{{ s.home.no_defeat }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.away.no_defeat > 0 %}text-success fw-bold{% endif %}">
                                                        {% if s.away.no_defeat > 0 %}{{ s.away.no_defeat }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.total.no_defeat > 0 %}text-success fw-bold{% endif %}">
                                                        {% if s.total.no_defeat > 0 %}{{ s.total.no_defeat }}{% else %}-{% endif %}</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-start text-secondary">Scored 1+ goals</td>
                                                    <td
                                                        class="{% if s.home.score_1plus > 0 %}text-success fw-bold{% endif %}">
                                                        {% if s.home.score_1plus > 0 %}{{ s.home.score_1plus }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.away.score_1plus > 0 %}text-success fw-bold{% endif %}">
                                                        {% if s.away.score_1plus > 0 %}{{ s.away.score_1plus }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.total.score_1plus > 0 %}text-success fw-bold{% endif %}">
                                                        {% if s.total.score_1plus > 0 %}{{ s.total.score_1plus }}{% else %}-{% endif %}</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-start text-secondary">Conceded 1+ goals</td>
                                                    <td
                                                        class="{% if s.home.concede_1plus > 0 %}text-danger fw-bold{% endif %}">
                                                        {% if s.home.concede_1plus > 0 %}{{ s.home.concede_1plus }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.away.concede_1plus > 0 %}text-danger fw-bold{% endif %}">
                                                        {% if s.away.concede_1plus > 0 %}{{ s.away.concede_1plus }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.total.concede_1plus > 0 %}text-danger fw-bold{% endif %}">
                                                        {% if s.total.concede_1plus > 0 %}{{ s.total.concede_1plus }}{% else %}-{% endif %}</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-start text-secondary">Did not score</td>
                                                    <td
                                                        class="{% if s.home.no_score > 0 %}text-danger fw-bold{% endif %}">
                                                        {% if s.home.no_score > 0 %}{{ s.home.no_score }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.away.no_score > 0 %}text-danger fw-bold{% endif %}">
                                                        {% if s.away.no_score > 0 %}{{ s.away.no_score }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.total.no_score > 0 %}text-danger fw-bold{% endif %}">
                                                        {% if s.total.no_score > 0 %}{{ s.total.no_score }}{% else %}-{% endif %}</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-start text-secondary">Did not concede</td>
                                                    <td
                                                        class="{% if s.home.no_concede > 0 %}text-success fw-bold{% endif %}">
                                                        {% if s.home.no_concede > 0 %}{{ s.home.no_concede }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.away.no_concede > 0 %}text-success fw-bold{% endif %}">
                                                        {% if s.away.no_concede > 0 %}{{ s.away.no_concede }}{% else %}-{% endif %}</td>
                                                    <td
                                                        class="{% if s.total.no_concede > 0 %}text-success fw-bold{% endif %}">
                                                        {% if s.total.no_concede > 0 %}{{ s.total.no_concede }}{% else %}-{% endif %}</td>
                                                </tr>
                                                {% endwith %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Comparison with league average -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card border-0 bg-white bg-opacity-10 text-white shadow-sm">
                    <div
                        class="card-header bg-transparent border-bottom border-secondary border-opacity-25 py-3 d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 fw-bold"><i class="fa-solid fa-scale-balanced text-info me-2"></i>Comparison
                            with league average</h5>
                        <div class="small d-flex gap-2">
                            <span class="badge bg-secondary bg-opacity-50">Total</span>
                            <span
                                class="badge bg-dark bg-opacity-50 text-secondary border border-secondary border-opacity-25">Home</span>
                            <span
                                class="badge bg-dark bg-opacity-50 text-secondary border border-secondary border-opacity-25">Away</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row g-4">
                            <!-- Team 1 -->
                            <div class="col-md-6">
                                <div
                                    class="p-3 border border-secondary border-opacity-25 rounded bg-dark bg-opacity-25 h-100">
                                    <div
                                        class="d-flex align-items-center mb-3 pb-2 border-bottom border-secondary border-opacity-25">
                                        <img src="{{ team1.logo_url }}" class="me-2" style="height: 24px;">
                                        <h6 class="mb-0 fw-bold">{{ team1.name }}</h6>
                                    </div>
                                    <div class="table-responsive">
                                        <table
                                            class="table table-dark table-sm table-borderless mb-0 align-middle small">
                                            <thead>
                                                <tr
                                                    class="text-secondary border-bottom border-secondary border-opacity-25">
                                                    <th class="text-start">Statistic</th>
                                                    <th class="text-center" style="width: 60px;">Team</th>
                                                    <th style="width: 100px;"></th>
                                                    <th class="text-center" style="width: 60px;">League</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for row in t1_league_comparison %}
                                                <tr>
                                                    <td class="text-start text-secondary">{{ row.label }}</td>
                                                    <td
                                                        class="text-center fw-bold {% if row.status_class == 'win' or row.status_class == 'good' %}text-success{% elif row.status_class == 'loss' or row.status_class == 'bad' %}text-danger{% else %}text-secondary{% endif %}">
                                                        {{ row.team_val|floatformat:row.decimals }}{% if row.is_pct %}%{% endif %}
                                                    </td>
                                                    <td class="align-middle px-2">
                                                        <div class="progress mb-1"
                                                            style="height: 6px; background-color: rgba(255,255,255,0.1);">
                                                            <div class="progress-bar {% if row.status_class == 'win' or row.status_class == 'good' %}bg-success{% elif row.status_class == 'loss' or row.status_class == 'bad' %}bg-danger{% else %}bg-secondary{% endif %}"
                                                                role="progressbar" style="width: 0%"
                                                                data-width="{{ row.team_width }}"></div>
                                                        </div>
                                                        <div class="progress"
                                                            style="height: 4px; background-color: rgba(255,255,255,0.05);">
                                                            <div class="progress-bar bg-secondary opacity-50"
                                                                role="progressbar" style="width: 0%"
                                                                data-width="{{ row.league_width }}"></div>
                                                        </div>
                                                    </td>
                                                    <td class="text-center text-secondary opacity-75">
                                                        {{ row.league_val|floatformat:row.decimals }}{% if row.is_pct %}%{% endif %}
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- Team 2 -->
                            <div class="col-md-6">
                                <div
                                    class="p-3 border border-secondary border-opacity-25 rounded bg-dark bg-opacity-25 h-100">
                                    <div
                                        class="d-flex align-items-center mb-3 pb-2 border-bottom border-secondary border-opacity-25">
                                        <img src="{{ team2.logo_url }}" class="me-2" style="height: 24px;">
                                        <h6 class="mb-0 fw-bold">{{ team2.name }}</h6>
                                    </div>
                                    <div class="table-responsive">
                                        <table
                                            class="table table-dark table-sm table-borderless mb-0 align-middle small">
                                            <thead>
                                                <tr
                                                    class="text-secondary border-bottom border-secondary border-opacity-25">
                                                    <th class="text-start">Statistic</th>
                                                    <th class="text-center" style="width: 60px;">Team</th>
                                                    <th style="width: 100px;"></th>
                                                    <th class="text-center" style="width: 60px;">League</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for row in t2_league_comparison %}
                                                <tr>
                                                    <td class="text-start text-secondary">{{ row.label }}</td>
                                                    <td
                                                        class="text-center fw-bold {% if row.status_class == 'win' or row.status_class == 'good' %}text-success{% elif row.status_class == 'loss' or row.status_class == 'bad' %}text-danger{% else %}text-secondary{% endif %}">
                                                        {{ row.team_val|floatformat:row.decimals }}{% if row.is_pct %}%{% endif %}
                                                    </td>
                                                    <td class="align-middle px-2">
                                                        <div class="progress mb-1"
                                                            style="height: 6px; background-color: rgba(255,255,255,0.1);">
                                                            <div class="progress-bar {% if row.status_class == 'win' or row.status_class == 'good' %}bg-success{% elif row.status_class == 'loss' or row.status_class == 'bad' %}bg-danger{% else %}bg-secondary{% endif %}"
                                                                role="progressbar" style="width: 0%"
                                                                data-width="{{ row.team_width }}"></div>
                                                        </div>
                                                        <div class="progress"
                                                            style="height: 4px; background-color: rgba(255,255,255,0.05);">
                                                            <div class="progress-bar bg-secondary opacity-50"
                                                                role="progressbar" style="width: 0%"
                                                                data-width="{{ row.league_width }}"></div>
                                                        </div>
                                                    </td>
                                                    <td class="text-center text-secondary opacity-75">
                                                        {{ row.league_val|floatformat:row.decimals }}{% if row.is_pct %}%{% endif %}
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- First Goal, Leading & Trailing -->
        <div class="row mt-4">
            <!-- Team 1 -->
            <div class="col-md-6">
                <div class="card border-0 bg-white bg-opacity-10 text-white shadow-sm h-100">
                    <div class="card-header bg-transparent border-bottom border-secondary border-opacity-25 py-3">
                        <h5 class="mb-0 fw-bold">First goal, leading & trailing</h5>
                    </div>
                    <div class="card-body">
                        <div class="p-3 mb-3 border border-secondary border-opacity-25 rounded bg-dark bg-opacity-25">
                            <div class="d-flex align-items-center mb-3">
                                <img src="{{ team1.logo_url }}" class="me-2" style="height: 20px;">
                                <span class="fw-bold">{{ team1.name }}</span>
                            </div>

                            <!-- Opening Goals -->
                            <h6 class="small text-secondary text-uppercase fw-bold mb-2">Opening Goals (Total)</h6>
                            <table class="table table-dark table-sm table-borderless mb-3 small align-middle">
                                <tr>
                                    <td class="text-success bg-success bg-opacity-10 rounded-start ps-2">Team scored
                                        first</td>
                                    <td class="text-center bg-success bg-opacity-10">{{ t1_leading_trailing_stats.team_scored_first }} / {{ t1_leading_trailing_stats.matches_played }}</td>
                                    <td class="bg-success bg-opacity-10" style="width: 100px;">
                                        <div class="progress" style="height: 6px;">
                                            <div class="progress-bar bg-success" style="width: 0%"
                                                data-width="{{ t1_leading_trailing_stats.pct_scored_first|floatformat:0 }}">
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-end fw-bold bg-success bg-opacity-10 rounded-end pe-2">{{ t1_leading_trailing_stats.pct_scored_first|floatformat:0 }}%</td>
                                </tr>
                                <tr>
                                    <td colspan="4" style="height: 2px;"></td>
                                </tr>
                                <tr>
                                    <td class="text-danger bg-danger bg-opacity-10 rounded-start ps-2">Opponent scored
                                        first</td>
                                    <td class="text-center bg-danger bg-opacity-10">{{ t1_leading_trailing_stats.opponent_scored_first }} / {{ t1_leading_trailing_stats.matches_played }}</td>
                                    <td class="bg-danger bg-opacity-10">
                                        <div class="progress" style="height: 6px;">
                                            <div class="progress-bar bg-danger" style="width: 0%"
                                                data-width="{{ t1_leading_trailing_stats.pct_opp_scored_first|floatformat:0 }}">
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-end fw-bold bg-danger bg-opacity-10 rounded-end pe-2">{{ t1_leading_trailing_stats.pct_opp_scored_first|floatformat:0 }}%</td>
                                </tr>
                            </table>

                            <!-- Avg Minutes -->
                            <div
                                class="d-flex justify-content-between small mb-3 border-bottom border-secondary border-opacity-25 pb-2">
                                <span class="text-secondary">Avg. minute scored first:</span>
                                <span class="fw-bold">{{ t1_leading_trailing_stats.avg_minute_scored_first|floatformat:0 }}'</span>
                            </div>
                            <div class="d-flex justify-content-between small mb-3">
                                <span class="text-secondary">Avg. minute conceded first:</span>
                                <span class="fw-bold">{{ t1_leading_trailing_stats.avg_minute_conceded_first|floatformat:0 }}'</span>
                            </div>

                            <!-- Half Time Lead -->
                            <h6 class="small text-secondary text-uppercase fw-bold mb-2 mt-4">Half-Time Lead (Total)
                            </h6>
                            <table class="table table-dark table-sm table-borderless mb-3 small align-middle">
                                <tr>
                                    <td class="text-success bg-success bg-opacity-10 rounded-start ps-2">Leading at HT
                                    </td>
                                    <td class="text-center bg-success bg-opacity-10">{{ t1_leading_trailing_stats.leading_at_ht }} / {{ t1_leading_trailing_stats.matches_played }}</td>
                                    <td class="bg-success bg-opacity-10" style="width: 100px;">
                                        <div class="progress" style="height: 6px;">
                                            <div class="progress-bar bg-success" style="width: 0%"
                                                data-width="{{ t1_leading_trailing_stats.pct_leading_ht|floatformat:0 }}">
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-end fw-bold bg-success bg-opacity-10 rounded-end pe-2">{{ t1_leading_trailing_stats.pct_leading_ht|floatformat:0 }}%</td>
                                </tr>
                                <tr>
                                    <td colspan="4" style="height: 2px;"></td>
                                </tr>
                                <tr>
                                    <td class="text-danger bg-danger bg-opacity-10 rounded-start ps-2">Trailing at HT
                                    </td>
                                    <td class="text-center bg-danger bg-opacity-10">{{ t1_leading_trailing_stats.opponent_leading_at_ht }} / {{ t1_leading_trailing_stats.matches_played }}</td>
                                    <td class="bg-danger bg-opacity-10">
                                        <div class="progress" style="height: 6px;">
                                            <div class="progress-bar bg-danger" style="width: 0%"
                                                data-width="{{ t1_leading_trailing_stats.pct_opp_leading_ht|floatformat:0 }}">
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-end fw-bold bg-danger bg-opacity-10 rounded-end pe-2">{{ t1_leading_trailing_stats.pct_opp_leading_ht|floatformat:0 }}%</td>
                                </tr>
                            </table>

                            <!-- Average Durations -->
                            <h6 class="small text-secondary text-uppercase fw-bold mb-2 mt-4">Average Durations (Total)
                            </h6>
                            <table class="table table-dark table-sm table-borderless mb-0 small align-middle">
                                <tr>
                                    <td class="text-success bg-success bg-opacity-10 rounded-start ps-2">Leading</td>
                                    <td class="text-end bg-success bg-opacity-10">{{ t1_leading_trailing_stats.avg_minutes_leading|floatformat:1 }} min</td>
                                    <td class="bg-success bg-opacity-10" style="width: 80px;">
                                        <div class="progress" style="height: 6px;">
                                            <div class="progress-bar bg-success" style="width: 0%"
                                                data-width="{{ t1_leading_trailing_stats.pct_leading|floatformat:0 }}">
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-end fw-bold bg-success bg-opacity-10 rounded-end pe-2">{{ t1_leading_trailing_stats.pct_leading|floatformat:0 }}%</td>
                                </tr>
                                <tr>
                                    <td colspan="4" style="height: 2px;"></td>
                                </tr>
                                <tr>
                                    <td class="text-secondary bg-white bg-opacity-10 rounded-start ps-2">Level</td>
                                    <td class="text-end bg-white bg-opacity-10">{{ t1_leading_trailing_stats.avg_minutes_level|floatformat:1 }} min</td>
                                    <td class="bg-white bg-opacity-10">
                                        <div class="progress" style="height: 6px;">
                                            <div class="progress-bar bg-secondary" style="width: 0%"
                                                data-width="{{ t1_leading_trailing_stats.pct_level|floatformat:0 }}">
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-end fw-bold bg-white bg-opacity-10 rounded-end pe-2">{{ t1_leading_trailing_stats.pct_level|floatformat:0 }}%</td>
                                </tr>
                                <tr>
                                    <td colspan="4" style="height: 2px;"></td>
                                </tr>
                                <tr>
                                    <td class="text-danger bg-danger bg-opacity-10 rounded-start ps-2">Trailing</td>
                                    <td class="text-end bg-danger bg-opacity-10">{{ t1_leading_trailing_stats.avg_minutes_trailing|floatformat:1 }} min</td>
                                    <td class="bg-danger bg-opacity-10">
                                        <div class="progress" style="height: 6px;">
                                            <div class="progress-bar bg-danger" style="width: 0%"
                                                data-width="{{ t1_leading_trailing_stats.pct_trailing|floatformat:0 }}">
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-end fw-bold bg-danger bg-opacity-10 rounded-end pe-2">{{ t1_leading_trailing_stats.pct_trailing|floatformat:0 }}%</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Team 2 -->
            <div class="col-md-6">
                <div class="card border-0 bg-white bg-opacity-10 text-white shadow-sm h-100">
                    <div
                        class="card-header bg-transparent border-bottom border-secondary border-opacity-25 py-3 d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 fw-bold">First goal, leading & trailing</h5>
                    </div>
                    <div class="card-body">
                        <div class="p-3 mb-3 border border-secondary border-opacity-25 rounded bg-dark bg-opacity-25">
                            <div class="d-flex align-items-center mb-3">
                                <img src="{{ team2.logo_url }}" class="me-2" style="height: 20px;">
                                <span class="fw-bold">{{ team2.name }}</span>
                            </div>

                            <!-- Opening Goals -->
                            <h6 class="small text-secondary text-uppercase fw-bold mb-2">Opening Goals (Total)</h6>
                            <table class="table table-dark table-sm table-borderless mb-3 small align-middle">
                                <tr>
                                    <td class="text-success bg-success bg-opacity-10 rounded-start ps-2">Team scored
                                        first</td>
                                    <td class="text-center bg-success bg-opacity-10">{{ t2_leading_trailing_stats.team_scored_first }} / {{ t2_leading_trailing_stats.matches_played }}</td>
                                    <td class="bg-success bg-opacity-10" style="width: 100px;">
                                        <div class="progress" style="height: 6px;">
                                            <div class="progress-bar bg-success" style="width: 0%"
                                                data-width="{{ t2_leading_trailing_stats.pct_scored_first|floatformat:0 }}">
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-end fw-bold bg-success bg-opacity-10 rounded-end pe-2">{{ t2_leading_trailing_stats.pct_scored_first|floatformat:0 }}%</td>
                                </tr>
                                <tr>
                                    <td colspan="4" style="height: 2px;"></td>
                                </tr>
                                <tr>
                                    <td class="text-danger bg-danger bg-opacity-10 rounded-start ps-2">Opponent scored
                                        first</td>
                                    <td class="text-center bg-danger bg-opacity-10">{{ t2_leading_trailing_stats.opponent_scored_first }} / {{ t2_leading_trailing_stats.matches_played }}</td>
                                    <td class="bg-danger bg-opacity-10">
                                        <div class="progress" style="height: 6px;">
                                            <div class="progress-bar bg-danger" style="width: 0%"
                                                data-width="{{ t2_leading_trailing_stats.pct_opp_scored_first|floatformat:0 }}">
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-end fw-bold bg-danger bg-opacity-10 rounded-end pe-2">{{ t2_leading_trailing_stats.pct_opp_scored_first|floatformat:0 }}%</td>
                                </tr>
                            </table>

                            <!-- Avg Minutes -->
                            <div
                                class="d-flex justify-content-between small mb-3 border-bottom border-secondary border-opacity-25 pb-2">
                                <span class="text-secondary">Avg. minute scored first:</span>
                                <span class="fw-bold">{{ t2_leading_trailing_stats.avg_minute_scored_first|floatformat:0 }}'</span>
                            </div>
                            <div class="d-flex justify-content-between small mb-3">
                                <span class="text-secondary">Avg. minute conceded first:</span>
                                <span class="fw-bold">{{ t2_leading_trailing_stats.avg_minute_conceded_first|floatformat:0 }}'</span>
                            </div>

                            <!-- Half Time Lead -->
                            <h6 class="small text-secondary text-uppercase fw-bold mb-2 mt-4">Half-Time Lead (Total)
                            </h6>
                            <table class="table table-dark table-sm table-borderless mb-3 small align-middle">
                                <tr>
                                    <td class="text-success bg-success bg-opacity-10 rounded-start ps-2">Leading at HT
                                    </td>
                                    <td class="text-center bg-success bg-opacity-10">{{ t2_leading_trailing_stats.leading_at_ht }} / {{ t2_leading_trailing_stats.matches_played }}</td>
                                    <td class="bg-success bg-opacity-10" style="width: 100px;">
                                        <div class="progress" style="height: 6px;">
                                            <div class="progress-bar bg-success" style="width: 0%"
                                                data-width="{{ t2_leading_trailing_stats.pct_leading_ht|floatformat:0 }}">
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-end fw-bold bg-success bg-opacity-10 rounded-end pe-2">{{ t2_leading_trailing_stats.pct_leading_ht|floatformat:0 }}%</td>
                                </tr>
                                <tr>
                                    <td colspan="4" style="height: 2px;"></td>
                                </tr>
                                <tr>
                                    <td class="text-danger bg-danger bg-opacity-10 rounded-start ps-2">Trailing at HT
                                    </td>
                                    <td class="text-center bg-danger bg-opacity-10">{{ t2_leading_trailing_stats.opponent_leading_at_ht }} / {{ t2_leading_trailing_stats.matches_played }}</td>
                                    <td class="bg-danger bg-opacity-10">
                                        <div class="progress" style="height: 6px;">
                                            <div class="progress-bar bg-danger" style="width: 0%"
                                                data-width="{{ t2_leading_trailing_stats.pct_opp_leading_ht|floatformat:0 }}">
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-end fw-bold bg-danger bg-opacity-10 rounded-end pe-2">{{ t2_leading_trailing_stats.pct_opp_leading_ht|floatformat:0 }}%</td>
                                </tr>
                            </table>

                            <!-- Average Durations -->
                            <h6 class="small text-secondary text-uppercase fw-bold mb-2 mt-4">Average Durations (Total)
                            </h6>
                            <table class="table table-dark table-sm table-borderless mb-0 small align-middle">
                                <tr>
                                    <td class="text-success bg-success bg-opacity-10 rounded-start ps-2">Leading</td>
                                    <td class="text-end bg-success bg-opacity-10">{{ t2_leading_trailing_stats.avg_minutes_leading|floatformat:1 }} min</td>
                                    <td class="bg-success bg-opacity-10" style="width: 80px;">
                                        <div class="progress" style="height: 6px;">
                                            <div class="progress-bar bg-success" style="width: 0%"
                                                data-width="{{ t2_leading_trailing_stats.pct_leading|floatformat:0 }}">
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-end fw-bold bg-success bg-opacity-10 rounded-end pe-2">{{ t2_leading_trailing_stats.pct_leading|floatformat:0 }}%</td>
                                </tr>
                                <tr>
                                    <td colspan="4" style="height: 2px;"></td>
                                </tr>
                                <tr>
                                    <td class="text-secondary bg-white bg-opacity-10 rounded-start ps-2">Level</td>
                                    <td class="text-end bg-white bg-opacity-10">{{ t2_leading_trailing_stats.avg_minutes_level|floatformat:1 }} min</td>
                                    <td class="bg-white bg-opacity-10">
                                        <div class="progress" style="height: 6px;">
                                            <div class="progress-bar bg-secondary" style="width: 0%"
                                                data-width="{{ t2_leading_trailing_stats.pct_level|floatformat:0 }}">
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-end fw-bold bg-white bg-opacity-10 rounded-end pe-2">{{ t2_leading_trailing_stats.pct_level|floatformat:0 }}%</td>
                                </tr>
                                <tr>
                                    <td colspan="4" style="height: 2px;"></td>
                                </tr>
                                <tr>
                                    <td class="text-danger bg-danger bg-opacity-10 rounded-start ps-2">Trailing</td>
                                    <td class="text-end bg-danger bg-opacity-10">{{ t2_leading_trailing_stats.avg_minutes_trailing|floatformat:1 }} min</td>
                                    <td class="bg-danger bg-opacity-10">
                                        <div class="progress" style="height: 6px;">
                                            <div class="progress-bar bg-danger" style="width: 0%"
                                                data-width="{{ t2_leading_trailing_stats.pct_trailing|floatformat:0 }}">
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-end fw-bold bg-danger bg-opacity-10 rounded-end pe-2">{{ t2_leading_trailing_stats.pct_trailing|floatformat:0 }}%</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
        <!-- Right Sidebar (25% Width) for Ads -->

        <!-- Right Sidebar (25% Width) for Ads -->
        <div class="col-lg-3">
            <div class="sticky-top" style="top: 20px; z-index: 100;">

                <!-- Vertical Ad Slot 1 -->
                <div class="card border-0 bg-transparent mb-4">
                    <div class="ad-slot text-center py-5 bg-dark bg-opacity-25 rounded border border-secondary border-opacity-10 d-flex flex-column justify-content-center align-items-center"
                        style="min-height: 250px;">
                        <span class="text-muted small text-uppercase letter-spacing-2 mb-2">Advertisement</span>
                        <div class="text-white-50 small"><i class="fa-solid fa-rectangle-ad fa-2x"></i></div>
                        <!-- Insert Ad Code Here -->
                    </div>
                </div>

                <!-- Vertical Ad Slot 2 (Tall Skyscraper) -->
                <div class="card border-0 bg-transparent mb-4">
                    <div class="ad-slot text-center py-5 bg-dark bg-opacity-25 rounded border border-secondary border-opacity-10 d-flex flex-column justify-content-center align-items-center"
                        style="min-height: 600px;">
                        <span class="text-muted small text-uppercase letter-spacing-2 mb-2">Advertisement
                            (Skyscraper)</span>
                        <div class="text-white-50 small"><i class="fa-solid fa-rectangle-ad fa-3x"></i></div>
                        <!-- Insert Ad Code Here -->
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Fix for CSS syntax errors: apply dynamic widths via JS
        const progressBars = document.querySelectorAll('[data-width]');
        progressBars.forEach(function (el) {
            const width = el.getAttribute('data-width');
            if (width) {
                // Ensure we don't overwrite other styles if possible, but style.width is safe
                el.style.width = width + '%';
            }
        });
    });
</script>
{% endblock %}
